exports.IMEI_add = function(req,res,db_model){	if(!req.query.hasOwnProperty("SN")) 	{		feedback(res,404,"system errors occurred");		return;		}	doc = {			SN:req.query.SN,			time : req.query.time||new Date(),			extral :req.query.information||"N/S"		};	// db_model.find({SN:doc.SN}).sort({'time':-1}).limit(1).exec(function(err,data)	db_model.findOne({SN:doc.SN},function(err,data)		{		if(err) feedback(res,404,"system errors occurred");		else 		{			if(null === data) insertInto(db_model,res);			else feedback(res,404,"this is test_failed");				 					}	});};exports.WIFI_add = function(req,res,db){	console.log("wifi");	if(!req.query.hasOwnProperty("SN")) 	{		feedback(res,404,"system errors occurred");		return;		}	doc = {			SN:req.query.SN,			time : req.query.time||new Date(),			result :req.query.result||"N/S"		};	console.log(doc);	db.create(doc,function(err){		if(err)		{			feedback(res,404,"system errors occurred");			throw err;		}		else 		{			feedback(res,200,"this is test_success");			console.log("sending");			}	});		};exports.downloadfile = function(req,res){	console.log("download");	var path = req.query.path;	var rootpath = __dirname.substr(0,(__dirname.length-15));	console.log(rootpath+path);	var option = {		root: rootpath,		dotfiles:"deny",		header:{			"Content-Type":"text/javascript",			"x-send":true,			"x-timestamp":Date.now()		}	};	// res.sendFile(path,option,function(err){	res.download(rootpath+path,"directory",function(err){			if(err) {			res.status(err.status).end();			throw err;		}		else			console.log("yes");	});};exports.duplicated = function(req,res,db_model){	if(!req.query.hasOwnProperty("SN")) 	{		feedback(res,404,"system errors occurred");		return;		}	doc = {			SN:req.query.SN,			time : req.query.time||new Date(),			extral :req.query.information||"N/S"		};	db_model.find({SN:doc.SN},function(err,data)		{		if(err) feedback(res,404,"system errors occurred");		else 		{			if(0 === data.length) feedback(res,200,"nothing existing ");			else if (1 === data.length) feedback(res,200,"good record ");			else			{ 				feedback(res,200,"duplicated");				console.log(data);			}	 					}	});};function feedback(res,num,msg){	res.writeHead(num,{"Content-Type" : "text/plain",		"connection":"close"});	res.write(msg);	res.end();}function insertInto(db_model,res){	db_model.create(doc,function(err)	{		if(err)			feedback(res,404,"system errors occurred");		else 			feedback(res,200,"this is test_success");				});	}